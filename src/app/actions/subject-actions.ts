\'use server\';\n\nimport { createServerActionClient } from \'@supabase/auth-helpers-nextjs\';\nimport { cookies } from \'next/headers\';\nimport { revalidatePath } from \'next/cache\';\n\ninterface SubjectActionResult {\n    success: boolean;\n    message: string;\n    subjectId?: string;\n}\n\n/**\n * Creates a new subject for the currently authenticated user.\n * @param name The name of the new subject.\n * @returns The result of the operation.\n */\nexport async function createSubject(name: string): Promise<SubjectActionResult> {\n    const supabase = createServerActionClient({ cookies });\n    const { data: { user } } = await supabase.auth.getUser();\n\n    if (!user) {\n        return { success: false, message: \'Authentication required.\' };\n    }\n\n    if (!name || name.trim().length < 2) {\n        return { success: false, message: \'Subject name must be at least 2 characters long.\' };\n    }\n\n    const { data, error } = await supabase\n        .from(\'subjects\')\n        .insert([{ name: name.trim(), owner_user_id: user.id }])\n        .select(\'id\')\n        .single();\n\n    if (error) {\n        return { success: false, message: `Failed to create subject: ${error.message}` };\n    }\n\n    revalidatePath(\'/teacher/dashboard\'); // Revalidate the dashboard to show the new subject\n    return { success: true, message: `Subject \'${name}\' created.`, subjectId: data.id };\n}\n\n/**\n * Deletes a subject and its associated questions.\n * @param subjectId The ID of the subject to delete.\n * @returns The result of the operation.\n */\nexport async function deleteSubject(subjectId: string): Promise<SubjectActionResult> {\n    const supabase = createServerActionClient({ cookies });\n    const { data: { user } } = await supabase.auth.getUser();\n\n    if (!user) {\n        return { success: false, message: \'Authentication required.\' };\n    }\n\n    // First, verify the user owns the subject\n    const { data: subjectData, error: ownerError } = await supabase\n        .from(\'subjects\')\n        .select(\'owner_user_id\')\n        .eq(\'id\', subjectId)\n        .single();\n\n    if (ownerError || !subjectData) {\n        return { success: false, message: \'Subject not found.\' };\n    }\n\n    if (subjectData.owner_user_id !== user.id) {\n        return { success: false, message: \'You are not authorized to delete this subject.\' };\n    }\n\n    // Due to ON DELETE SET NULL on questions.subject_id, we just delete the subject.\n    // If we wanted to delete questions, we would do that here first.\n    const { error } = await supabase.from(\'subjects\').delete().eq(\'id\', subjectId);\n\n    if (error) {\n        return { success: false, message: `Failed to delete subject: ${error.message}` };\n    }\n\n    revalidatePath(\'/teacher/dashboard\'); // Revalidate the dashboard\n    return { success: true, message: \'Subject deleted successfully.\' };\n}\n